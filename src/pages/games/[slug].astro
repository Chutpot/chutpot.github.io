---
import Base from '../../layouts/Base.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const games = await getCollection('games');
  return games.map((game) => ({
    params: { slug: game.slug },
    props: { game }
  }));
}

const { game } = Astro.props;
const { data } = game;
const { Content } = await game.render();
const cover = data.coverHorizontal ?? data.coverVertical ?? data.cover ?? '/ChutpotLogo.png';
---

<Base title={`${data.title}`} description={data.tagline}>
  <article class="prose max-w-3xl">
    <p class="text-xs font-semibold uppercase tracking-[0.25em] text-[color:var(--color-muted)]">
      {data.releaseDate
        ? new Date(data.releaseDate).toDateString()
        : 'Release: TBA'}
      {data.platforms?.length ? ` | ${data.platforms.join('  ')}` : ''}
    </p>
    <h1 class="mt-2 text-3xl font-semibold text-white">{data.title}</h1>
    <p class="mt-2 text-[color:var(--color-muted)]">{data.tagline}</p>
    {cover && (
      <div class="mt-5 overflow-hidden rounded-[var(--radius-xl)] border border-white/5 bg-[color:var(--color-panel)]">
        <img
          src={cover}
          alt={`${data.title} cover art`}
          class="max-h-[420px] w-full object-cover"
          loading="lazy"
          decoding="async"
        />
      </div>
    )}
    {data.link && (
      <p class="mt-3">
        <a class="inline-flex items-center gap-2 text-sm font-medium text-[color:var(--color-brand-100)]" href={data.link}>
          View store / page <span aria-hidden="true">?</span>
        </a>
      </p>
    )}
    <div class="mt-6 space-y-4 text-base leading-relaxed text-[color:var(--color-ink)]">
      <Content />
    </div>
  </article>
</Base>
